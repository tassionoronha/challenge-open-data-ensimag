<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<title>Challenge Open Datas</title>
	<!--<link rel="stylesheet" href="style.css">
	<script src="script.js"></script>-->
	<link href="js/c3/c3.css" rel="stylesheet">
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="js/c3/c3.js"></script>
</head>
<body>
	<h1>Affiche semaines</h1>
	<div id="chart"></div>
	<script>
		d3.text("datas/data_boulevard_all_2016.json", "text/plain", function(data) {
			var datas = JSON.parse(data);
			console.log(datas);

			tab = [];
			var dureePeriode = 7;
			var decalage = 0;
			var end = dureePeriode;
			var nbTour = 0;

			dataJour = datas[0].data;
			var keysJour = Object.keys(dataJour);
			var valuesJour = Object.values(dataJour);

			while(getDayInWeek(keysJour[decalage]) != 1){
				decalage++;
			}
			var init = decalage;
			console.log("init: "+init);

			end = init+dureePeriode;
			while(end<keysJour.length){
				nbTour++;

				arrayJourValues = [];
				arrayJourValues[0] = "semaine "+nbTour;

				for (var i = 1; i <= dureePeriode; i++) {
					arrayJourValues[i] = valuesJour[init+i-1];
				}

				tab[nbTour-1] = arrayJourValues;

				init = nbTour*dureePeriode+decalage;
				end = init+dureePeriode;
			}

			console.log("init: "+init+", nbTour: "+nbTour);

			console.log(tab);

			var chart = c3.generate({
				bindto: '#chart',
				data: {
					columns:tab
				},
				axis: {
					x: {
						type: 'category',
						categories: ['Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi','Dimanche']
					}
				}
			});
		});

		function getDayInWeek(myDate) {
			// Format : dd/mm/YYYY
			var d = new Date(myDate.split("/")[2], myDate.split("/")[1]-1, myDate.split("/")[0]);
			return d.getDay();
		}
	</script>	
</body>
</html>
