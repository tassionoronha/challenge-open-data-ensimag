<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<title>Challenge Open Datas</title>
	<!--<link rel="stylesheet" href="style.css">
	<script src="script.js"></script>-->
	<link href="js/c3/c3.css" rel="stylesheet">
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="js/c3/c3.js"></script>
</head>
<body>
	<h1>Affiche semaines</h1>
	<div id="chart"></div>
	<script>
		d3.text("datas/data_boulevard_all_2016.json", "text/plain", function(jsonData) {
			var allDatas = JSON.parse(jsonData);
			console.log(allDatas);

			tab = [];
			var dureePeriode = 7;
			var decalage = 0;
			var nbTour = 0;

			datas = allDatas[0].data;
			var keysJour = Object.keys(datas);
			var valuesJour = Object.values(datas);

			while(getDayInWeek(keysJour[decalage]) != 1){
				decalage++;
			}
			var debutPeriode = decalage;
			console.log("debutPeriode: "+debutPeriode);

			var finPeriode = debutPeriode+dureePeriode;
			while(finPeriode<keysJour.length){
				nbTour++;

				arrayJourValues = [];
				arrayJourValues[0] = "semaine "+nbTour;

				for (var i = 1; i <= dureePeriode; i++) {
					arrayJourValues[i] = valuesJour[debutPeriode+i-1];
				}

				tab[nbTour-1] = arrayJourValues;

				debutPeriode = nbTour*dureePeriode+decalage;
				finPeriode = debutPeriode+dureePeriode;
			}

			console.log("debutPeriode: "+debutPeriode+", nbTour: "+nbTour);

			console.log(tab);

			var chart = c3.generate({
				bindto: '#chart',
				data: {
					columns:tab
				},
				axis: {
					x: {
						type: 'category',
						categories: ['Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi','Dimanche']
					}
				}
			});
		});

		function getDayInWeek(myDate) {
			// Format : dd/mm/YYYY
			var d = new Date(myDate.split("/")[2], myDate.split("/")[1]-1, myDate.split("/")[0]);
			return d.getDay();
		}
	</script>	
</body>
</html>
